<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Metadata and external resources (CSS, PyScript, fonts) -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rock Paper Scissors with PyScript</title>

    <!-- PyScript styling and functionality -->
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>

    <!-- Custom styling and font imports -->
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Bebas+Neue&display=swap" rel="stylesheet">
</head>
<body>

    <!-- Game title and instructions -->
    <h1>Rock Paper Scissors Game</h1>
    <p>First to 3 points wins!</p>

    <!-- Player choice buttons (images) -->
    <div class="row">
        <!-- Rock choice button -->
        <div class="container">
            <div class="choice">
                <input type="image" src="./images/rocky.png" onclick="playGame('Rock')" width="300" height="auto">
            </div>        
        </div>

        <!-- Paper choice button -->
        <div class="container1">
            <div class="choice">
                <input type="image" src="./images/papery.png" onclick="playGame('Paper')" width="300" height="auto">       
            </div>
        </div>

        <!-- Scissors choice button -->
        <div class="container2">
            <div class="choice">
                <input type="image" src="./images/scissory.png" onclick="playGame('Scissors')" width="300" height="auto">
            </div>
        </div>
    </div>

    <!-- Game status display -->
    <div class="results">
        <!-- Player and computer scores -->
        <div class="p">Player Score: <span id="playerScore">0</span></div>
        <div class="p1">Computer Score: <span id="computerScore">0</span></div>
        <div class="p2">Computer chose: <span id="computerChoice">None</span></div>
        <div class="p3">Result: <span id="gameResult">No game played yet</span></div>
    </div>

    <!-- Game winner display -->
    <div class="winner" id="winner"></div>

    <!-- PyScript code for game logic -->
    <py-script>
        import random

        # Initialize player and computer scores
        player_score = 0
        computer_score = 0

        # Function to determine the winner of each round
        def determine_winner(player_choice, computer_choice):
            if player_choice == computer_choice:
                return "draw"
            elif (player_choice == "Rock" and computer_choice == "Scissors") or \
                 (player_choice == "Paper" and computer_choice == "Rock") or \
                 (player_choice == "Scissors" and computer_choice == "Paper"):
                return "win"
            else:
                return "lose"

        # Main game function
        def play_game(player_choice):
            global player_score, computer_score
            choices = ["Rock", "Paper", "Scissors"]
            computer_choice = random.choice(choices)

            # Update computer's choice in the HTML
            Element("computerChoice").element.innerText = computer_choice

            # Determine and display round result
            result = determine_winner(player_choice, computer_choice)
            if result == "win":
                player_score += 1
                Element("gameResult").element.innerText = "You win this round!"
                js.changeBackground("player")  # JS to change background on player win
            elif result == "lose":
                computer_score += 1
                Element("gameResult").element.innerText = "Computer wins this round!"
                js.changeBackground("computer")  # JS to change background on computer win
            else:
                Element("gameResult").element.innerText = "It's a draw!"
                js.changeBackground("draw")  # JS to change background on draw

            # Update scores in HTML
            Element("playerScore").element.innerText = player_score
            Element("computerScore").element.innerText = computer_score

            # Check for overall game winner
            if player_score == 3:
                Element("winner").element.innerText = "Congratulations! You won the game! - reload to restart the game"
                reset_game()
            elif computer_score == 3:
                Element("winner").element.innerText = "Game over! The computer won the game! - reload to restart the game"
                reset_game()

        # Function to reset the game scores and UI
        def reset_game():
            global player_score, computer_score
            player_score = 0
            computer_score = 0
            js.window.setTimeout(lambda: reset_ui(), 3000)  # Reset UI after 3 seconds

        # UI reset function
        def reset_ui():
            Element("playerScore").element.innerText = "0"
            Element("computerScore").element.innerText = "0"
            Element("gameResult").element.innerText = "No game played yet"
            Element("computerChoice").element.innerText = "None"
            Element("winner").element.innerText = ""
    </py-script>

    <!-- JavaScript for background change on game results -->
    <script>
        function changeBackground(result) {
            if (result === "player") {
                document.body.style.backgroundImage = "url(...player-win.gif)";
            } else if (result === "computer") {
                document.body.style.backgroundImage = "url(...computer-win.gif)";
            } else if (result === "draw") {
                document.body.style.backgroundImage = "url(...draw.gif)";
            }

            // Reset background after 1 second
            setTimeout(function () {
                document.body.style.backgroundImage = "url(...neutral-background.gif)";
            }, 1000);
        }

        // JS function to trigger PyScript function with player choice
        function playGame(playerChoice) {
            pyscript.interpreter.globals.get("play_game")(playerChoice);
        }
    </script>

</body>
</html>
